@page "/game/{Id}"

@using Codenames.Data;
@using Microsoft.AspNetCore.Http;

@inject WordService _wordService
@inject IHttpContextAccessor _contextAccessor

@if (game == null)
{
    game = _wordService.GetGame(int.Parse(Id));
}
@if (game != null)
{
    int? userId = _contextAccessor.HttpContext.Request.Cookies.ContainsKey("userid")
        ? (int?)int.Parse(_contextAccessor.HttpContext.Request.Cookies["userid"])
        : null;

    var showJoin = !game.Players.Any(a => a.playerId == userId);
    var showRedSmJoin = !game.Players.Any(a => a.isSpyMaster && a.team == Team.Red);
    var showBlueSmJoin = !game.Players.Any(a => a.isSpyMaster && a.team == Team.Blue);
    var showLeave = game.Players.Any(a => a.playerId == userId);

    <div>
        <button type="button" class="join btn btn-primary neutral @(showJoin ? "" : "hide")" onclick="joinGame()">Join Game</button>
        <button type="button" class="sm-join btn btn-primary red @(showRedSmJoin ? "" : "hide")" onclick="joinGameAsSm(0)">Join Game as Red SM</button>
        <button type="button" class="sm-join btn btn-primary blue @(showBlueSmJoin ? "" : "hide")" onclick="joinGameAsSm(1)">Join Game as Blue SM</button>
        <button type="button" class="leave btn btn-primary assassin @(showLeave ? "" : "hide")" onclick="leaveGame()">Leave Game</button>
    </div>
    <br />
    <div class="row">
        <div class="col-sm chat-column">
            <ChatControl id="red-chat">Red Chat</ChatControl>
        </div>
        <div class="col-md">
            <div class="grid-container">
                @foreach (var item in game.Words)
                {
                    var tmpWord = item;

                    <div class="grid-item @item.word @(game.IsOver || item.isGuessed ? item.state.ToString().ToLower() : "")" @onclick="() => _wordService.MarkAsClicked(game, tmpWord.word)">
                        @item.word
                    </div>
                }
            </div>
        </div>
        <div class="col-sm chat-column">
            <ChatControl id="blue-chat">Blue Chat</ChatControl>
        </div>
    </div>
}

@code {
    [Parameter]
    public string Id { get; set; }

    Game game = null;
}
